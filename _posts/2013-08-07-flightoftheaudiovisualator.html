---
title: Flight of the Audio Visualator
subtitle: starring HTML5 Audio and Three.js
layout: master
description:
theme: night
---

<style>
    h1, h2, h3, p {
        text-shadow: 0 0 5px #000 !important;
    }
    #bg-iframe {
        position: absolute;
        z-index: -1;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
</style>
<script>
    var iframe = document.createElement('iframe');
    iframe.id = 'bg-iframe';
    iframe.src = 'http://localhost:3000/visualiser/22';
    document.body.appendChild(iframe);

    // the context
    var context = new window.webkitAudioContext();

    // analyser can give details about the frequencies
    var analyser = context.createAnalyser();
    analyser.smoothingTimeConstant = 0.3;
    analyser.fftSize = 1024;

    // javascriptNode allows us to do something in a bit like a frame
    var javascriptNode = context.createJavaScriptNode(2048, 1, 1);
    javascriptNode.connect(context.destination);

    var t;
    function next() {
        clearTimeout(t);
        t = setTimeout(function(){
            Reveal.next();
        }, 100);
    }

    javascriptNode.onaudioprocess = function(){
        // get average vol
        var frequenciesArr = new Uint8Array(analyser.frequencyBinCount);
        analyser.getByteFrequencyData(frequenciesArr);
        var average = getAverageVolume(Array.prototype.slice.call(frequenciesArr, 0, 200));
        if (average > 150){
            console.log(average);
            next();
        }
    };
    function getAverageVolume(arr) {
        var values = 0, length = arr.length;
        for (var i=0; i < length; i++){
            values+=arr[i];
        }
        return values/length;
    }

    navigator.webkitGetUserMedia({audio: true}, function(stream) {

        var microphone = context.createMediaStreamSource(stream);
        // microphone -> analyser -> process
        microphone.connect(analyser);
        analyser.connect(javascriptNode);
        // microphone.connect(context.destination);


    }, function(){
        alert('Something went wrong');
    });

</script>

{% include slide-title.html %}

<section>

<section data-markdown data-separator="---">

## A whole new world of sound

- Web Audio API

</section>

</section>















<section>

<section data-markdown data-separator="---">

## The Source

 - load an audio file in to an audio element
 - load an audio file in to a buffer
 - create waves with oscillators
 - connect an audio stream from a microphone


---

## Load an mp3 file into an Audio element

We need an audio element:

    var audio = new Audio();
    audio.autoplay = true;

Give it a src:

    audio.src = 'joining-the-dots.mp3';

---

## Have a listen

[Play Simple Audio element](code-examples/play-audio-element.html)

---

## What about from a buffer?

We are able to load sound using xhr or via a microphone
and connect it

---

## Creating waves with Oscillators

First we need a context.

Our Oscillator can be created out of the context.

We then just need to connect up the wires
to our end destination (speakers).

    var context = new webkitAudioContext();
    var oscillator = context.createOscillator();
    oscillator.connect(context.destination);

---

---

## What waves can we create?

Using the `type` property we have 4 options.

![oscillator types](waves.jpg)

0: Sine, 1: Square, 2: Triangle, 3: Sawtooth

*[image courtesy of Stuart Memo](http://stuartmemo.com/making-sine-square-sawtooth-and-triangle-waves/)*

---

## I want to play a tune

Ok, so you can then set the frequency of the wave.

    oscillator.type = 0;
    oscillator.frequency.value = 440; // A

[Here these in action](code-examples/oscillator.html)

---

## HTML5 Synth

http://stuartmemo.com/synth/


</section>


</section>




<!-- THE DRAG -->
<section>

<section data-markdown data-separator="---">

## The Drag

In this visualiser I used the file API to allow an mp3 to be dragged
on to the page.

This is how this works.

</section>

</section>

















<!-- THE DESTINATION -->
<section>

<section data-markdown data-separator="---">

## The Destination

</section>

</section>


























<section>


<section data-markdown data-separator="---">

## The Playground

<http://localhost:3000/audio-spectrum>
<http://localhost:3000/tones/1>

---

## Visualiser

Just map the spectrum with time
<http://localhost:3000/visualiser/2>

---

## Spider thing
<http://localhost:3000/visualiser/3>

---

## Find some camera angles
<http://localhost:3000/visualiser/14>

## Noise and Interpolation
<http://localhost/davetayls/teststation/creative-js/grapher/noise.html>
<http://localhost/davetayls/teststation/creative-js/grapher/interpolation.html>

---

## Animate them
<http://localhost:3000/visualiser/15>

---

## Finishing Touches
 - drag an mp3
 - animation and flights
 - narratives
<http://localhost:3000/visualiser/20>



</section>

</section>
















<section>


<section data-markdown data-separator="---">

## What are people creating

 - Synth
 - Drum machine

## Resources

- http://stuartmemo.com

</section>

</section>